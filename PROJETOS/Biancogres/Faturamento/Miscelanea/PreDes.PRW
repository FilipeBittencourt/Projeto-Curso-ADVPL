#include "rwMake.ch"
#include "Topconn.ch"
/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณ PREVDES        บAutor  ณ HARLEY DIAS KOEHLERบ Data ณ  14/03/07   บฑฑ
ฑฑฬออออออออออุออออออออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ RELATORIO DE PREVISAO DE DESPESAS - MARKETING                    บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ AP 7                                                             บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function PREDES()
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Declaracao de Variaveis                                             ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
Private cSQL
Private Enter := CHR(13)+CHR(10) 
lEnd       := .F.
cString    := ""
cDesc1     := "Este programa tem como objetivo imprimir relatorio "
cDesc2     := "de acordo com os parametros informados pelo usuario."
cDesc3     := "Comparativo de Pesos "
cTamanho   := ""
limite     := 80		
aReturn    := { "Zebrado", 1, "Administracao", 2, 2, 1, "", 1}
cNomeprog  := "PREDES"
cPerg      := "PREDES"
aLinha     := {}
nLastKey   := 0
cTitulo	   := "Relatorio Previsao de Despesas - Marketing"
Cabec1     := ""
Cabec2     := ""
nBegin     := 0
cDescri    := ""
cCancel    := "***** CANCELADO PELO OPERADOR *****"
m_pag      := 1                                    
wnrel      := "PREDES"
lprim      := .t.
li         := 80
nTipo      := 0
wFlag      := .t. 

      
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Envia controle para a funcao SETPRINT.								     ณ
//ณ Verifica Posicao do Formulario na Impressora.				             ณ
//ณ Solicita os parametros para a emissao do relatorio			             |
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
pergunte(cPerg,.F.)
wnrel := SetPrint(cString,cNomeProg,cPerg,@cTitulo,cDesc1,cDesc2,cDesc3,.F.,    ,.T.,cTamanho,,.F.)
//Cancela a impressao
If nLastKey == 27
	Return
Endif

cSQL := ""
cSQL += "ALTER VIEW VW_PREDES AS " + Enter
cSQL += "SELECT ZO_DATA AS DATA, A3_NOME AS REPRESENTANTE,	A1_NOME AS CLIENTE, ZO_VALOR AS VALOR, " + Enter
cSQL += "		ZO_TPDES AS TIPODESP, ZO_FPAGTO AS FORMAPAG, ZO_DESCR AS DESCRICAO, A1_COD, A1_GRPVEN " + Enter
cSQL += "FROM " + RetSqlName("SZO") + " SZO, " + RetSqlName("SA1") + " SA1, " + RetSqlName("SA3") + " SA3 "+ Enter
cSQL += "WHERE 	SZO.D_E_L_E_T_ = '' AND SA1.D_E_L_E_T_ = '' AND SA3.D_E_L_E_T_ = '' AND " + Enter
cSQL += "		ZO_REPRE = A3_COD AND ZO_CLIENTE = A1_COD AND ZO_LOJA = A1_LOJA AND " + Enter
cSQL += "		ZO_STATUS		= 'Baixa Total' AND " + Enter
cSQL += "		ZO_DATA BETWEEN '"+Dtos(MV_PAR01)+"' AND '"+Dtos(MV_PAR02)+"' AND " + Enter
cSQL += "		ZO_REPRE BETWEEN '"+MV_PAR03+"' AND '"+MV_PAR04+"' AND " + Enter
cSQL += "		ZO_CLIENTE BETWEEN '"+MV_PAR05+"' AND '"+MV_PAR06+"' " + Enter
cSQL += "		AND SA1.A1_GRPVEN BETWEEN '"+MV_PAR07+"' AND '"+MV_PAR08+"'  " + Enter
cSQL += "		AND SZO.ZO_SERIE BETWEEN '"+MV_PAR09+"' AND '"+MV_PAR10+"'  " + Enter
IF ALLTRIM(MV_PAR11) <> ""
	cSQL += "		AND SA3.A3_COD IN (SELECT ZZI_VEND FROM "+RetSqlName("ZZI")+" WHERE ZZI_FILIAL = '"+xFilial("ZZI")+"'	AND ZZI_ATENDE = '"+MV_PAR11+"'	AND D_E_L_E_T_ = '') " + Enter
END IF 

TcSQLExec(cSQL)                    	
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Se impressao em disco, chama o gerenciador de impressao...          ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
If aReturn[5]==1
	//Parametros Crystal Em Disco
	Private cOpcao:="1;0;1;Apuracao"
Else
	//Direto Impressora
	Private cOpcao:="3;0;1;Apuracao"
Endif
callcrys("PREDES",Dtoc(MV_PAR01)+";"+Dtoc(MV_PAR02)+";"+MV_PAR03+";"+MV_PAR04+";"+MV_PAR05+";"+MV_PAR06+";"+MV_PAR07+";"+MV_PAR08+";"+cempant,cOpcao)

Return